(this.webpackJsonpwebmessenger=this.webpackJsonpwebmessenger||[]).push([[0],{43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(1),r=n.n(c),s=n(26),i=n.n(s),o=(n(43),n(19)),u=n(7),l=(n(44),n(17)),d=(n(45),n(46),n(9)),j=n(10),b=n.n(j),f=n(20),p=n(13),h=(n(33),n(34),"USER_LOGIN"),O="USER_LOGOUT",m="GET_REALTIME_USERS",g="GET_REALTIME_MESSAGES",v=n(6),x=function(e){var t=Object(d.c)((function(e){return e.auth})),n=Object(d.b)();return Object(a.jsxs)("header",{className:"header",children:[Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)("div",{className:"logo",children:Object(a.jsx)(o.b,{to:"/",style:{color:"#fff"},children:"Web Messenger"})}),t.authenticated?null:Object(a.jsxs)("ul",{className:"leftMenu",children:[Object(a.jsx)("li",{children:Object(a.jsx)(o.c,{to:"/login",children:"Login"})}),Object(a.jsx)("li",{children:Object(a.jsx)(o.c,{to:"/signup",children:"Sign up"})})]})]}),Object(a.jsx)("div",{style:{margin:"20px 0",color:"#fff",fontWeight:"bold"},children:t.authenticated?"Hi ".concat(t.firstName," ").concat(t.lastName):""}),Object(a.jsx)("ul",{className:"menu",children:t.authenticated?Object(a.jsx)("li",{children:Object(a.jsx)(o.b,{to:"#",onClick:function(){var e;n((e=t.uid,function(){var t=Object(f.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"".concat(O,"_REQUEST")}),p.a.firestore().collection("users").doc(e).update({isOnline:!1}).then((function(){p.a.auth().signOut().then((function(){localStorage.clear(),n({type:"".concat(O,"_SUCCESS")})})).catch((function(e){console.log(e),n({type:"".concat(O,"_FAILURE"),payload:{error:e}})}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},children:"Logout"})}):null})]})};function S(e){return Object(a.jsxs)("div",{children:[Object(a.jsx)(x,{}),e.children]})}var y=function(e){var t=e.user,n=e.onClick;return Object(a.jsxs)("div",{onClick:function(){return n(t)},className:"displayName",children:[Object(a.jsx)("div",{className:"displayPic",children:Object(a.jsx)("img",{src:"https://i.pinimg.com/originals/be/ac/96/beac96b8e13d2198fd4bb1d5ef56cdcf.jpg",alt:""})}),Object(a.jsxs)("div",{style:{display:"flex",flex:1,justifyContent:"space-between",margin:"0 10px"},children:[Object(a.jsxs)("span",{style:{fontWeight:500},children:[t.firstName," ",t.lastName]}),Object(a.jsx)("span",{className:t.isOnline?"onlineStatus":"onlineStatus off"})]})]})},_=function(e){var t,n=Object(d.b)(),r=Object(d.c)((function(e){return e.auth})),s=Object(d.c)((function(e){return e.user})),i=Object(c.useState)(!1),o=Object(l.a)(i,2),u=o[0],j=o[1],h=Object(c.useState)(""),O=Object(l.a)(h,2),x=O[0],_=O[1],E=Object(c.useState)(""),w=Object(l.a)(E,2),N=w[0],C=w[1],U=Object(c.useState)(null),I=Object(l.a)(U,2),k=I[0],A=I[1];Object(c.useEffect)((function(){var e;t=n((e=r.uid,function(){var t=Object(f.a)(b.a.mark((function t(n){var a,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"".concat(m,"_REQUEST")}),a=p.a.firestore(),c=a.collection("users").onSnapshot((function(t){var a=[];t.forEach((function(t){t.data().uid!=e&&a.push(t.data())})),n({type:"".concat(m,"_SUCCESS"),payload:{users:a}})})),t.abrupt("return",c);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).then((function(e){return e})).catch((function(e){console.log(e)}))}),[]),Object(c.useEffect)((function(){return function(){t.then((function(e){return e()})).catch((function(e){return console.log(e)}))}}),[]);var R=function(e){j(!0),_("".concat(e.firstName," ").concat(e.lastName)),A(e.uid),console.log(e),n(function(e){return function(){var t=Object(f.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.a.firestore().collection("conversations").where("user_uid_1","in",[e.uid_1,e.uid_2]).orderBy("createdAt","asc").onSnapshot((function(t){var a=[];t.forEach((function(t){(t.data().user_uid_1==e.uid_1&&t.data().user_uid_2==e.uid_2||t.data().user_uid_1==e.uid_2&&t.data().user_uid_2==e.uid_1)&&a.push(t.data())})),n({type:g,payload:{conversations:a}}),console.log(a)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({uid_1:r.uid,uid_2:e.uid}))};return Object(a.jsx)(S,{children:Object(a.jsxs)("section",{className:"container",children:[Object(a.jsx)("div",{className:"listOfUsers",children:s.users.length>0?s.users.map((function(e){return Object(a.jsx)(y,{onClick:R,user:e},e.uid)})):null}),Object(a.jsxs)("div",{className:"chatArea",children:[Object(a.jsx)("div",{className:"chatHeader",children:u?x:""}),Object(a.jsx)("div",{className:"messageSections",children:u?s.conversations.map((function(e){return Object(a.jsx)("div",{style:{textAlign:e.user_uid_1==r.uid?"right":"left"},className:e.user_uid_1==r.uid?"right":"left",children:Object(a.jsx)("p",{className:"messageStyle",children:e.message})})})):null}),u?Object(a.jsxs)("div",{className:"chatControls",children:[Object(a.jsx)("textarea",{value:N,onChange:function(e){return C(e.target.value)},placeholder:"Write Message"}),Object(a.jsx)("button",{onClick:function(e){var t={user_uid_1:r.uid,user_uid_2:k,message:N};""!==N&&n(function(e){return function(){var t=Object(f.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.a.firestore().collection("conversations").add(Object(v.a)(Object(v.a)({},e),{},{isView:!1,createdAt:new Date})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t)).then((function(){C("")}))},children:"Send"})]}):null]})]})})};n(55);function E(e){return Object(a.jsx)("div",{className:"card",children:e.children})}n(56);var w=function(e){var t=Object(c.useState)(""),n=Object(l.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(""),o=Object(l.a)(i,2),j=o[0],O=o[1],m=Object(d.b)();return Object(d.c)((function(e){return e.auth})).authenticated?Object(a.jsx)(u.a,{to:"/"}):Object(a.jsx)(S,{children:Object(a.jsx)("div",{className:"loginContainer",children:Object(a.jsx)(E,{children:Object(a.jsxs)("form",{onSubmit:function(e){var t;(e.preventDefault(),""!=r)?""!=j?m((t={email:r,password:j},function(){var e=Object(f.a)(b.a.mark((function e(n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"".concat(h,"_REQUEST")}),p.a.auth().signInWithEmailAndPassword(t.email,t.password).then((function(e){console.log(e),p.a.firestore().collection("users").doc(e.user.uid).update({isOnline:!0}).then((function(){var t=e.user.displayName.split(" "),a={firstName:t[0],lastName:t[1],uid:e.user.uid,email:e.user.email};localStorage.setItem("user",JSON.stringify(a)),n({type:"".concat(h,"_SUCCESS"),payload:{user:a}})})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e),n({type:"".concat(h,"_FAILURE"),payload:{error:e}})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):alert("Password is required"):alert("Email is required")},children:[Object(a.jsx)("input",{name:"email",type:"text",value:r,onChange:function(e){return s(e.target.value)},placeholder:"Email"}),Object(a.jsx)("input",{name:"password",type:"password",value:j,onChange:function(e){return O(e.target.value)},placeholder:"Password"}),Object(a.jsx)("div",{children:Object(a.jsx)("button",{children:"Login"})})]})})})})};n(57);function N(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)(""),i=Object(l.a)(s,2),o=i[0],j=i[1],O=Object(c.useState)(""),m=Object(l.a)(O,2),g=m[0],v=m[1],x=Object(c.useState)(""),y=Object(l.a)(x,2),_=y[0],w=y[1],N=Object(d.b)();return Object(d.c)((function(e){return e.auth})).authenticated?Object(a.jsx)(u.a,{to:"/"}):Object(a.jsx)(S,{children:Object(a.jsx)("div",{className:"registerContainer",children:Object(a.jsx)(E,{children:Object(a.jsxs)("form",{onSubmit:function(e){e.preventDefault(),N(function(e){return function(){var t=Object(f.a)(b.a.mark((function t(n){var a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=p.a.firestore(),n({type:"".concat(h,"_REQUEST")}),p.a.auth().createUserWithEmailAndPassword(e.email,e.password).then((function(t){console.log(t);var c=p.a.auth().currentUser,r="".concat(e.firstname," ").concat(e.lastname);c.updateProfile({displayName:r}).then((function(){a.collection("users").doc(t.user.uid).set({firstName:e.firstname,lastName:e.lastname,uid:t.user.uid,createdAt:new Date,isOnline:!0}).then((function(){var a={firstName:e.firstname,lastName:e.lastname,uid:t.user.uid,email:e.email};localStorage.setItem("user",JSON.stringify(a)),console.log("user logged in successfully"),n({type:"".concat(h,"_SUCCESS"),payload:{user:a}})})).catch((function(e){console.log(e),n({type:"".concat(h,"_FAILURE"),payload:{error:e}})}))}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({firstname:n,lastname:o,email:g,password:_}))},children:[Object(a.jsx)("input",{type:"text",placeholder:"Firstname",value:n,onChange:function(e){return r(e.target.value)}}),Object(a.jsx)("input",{type:"text",placeholder:"Lastname",value:o,onChange:function(e){return j(e.target.value)}}),Object(a.jsx)("input",{type:"email",placeholder:"Email",value:g,onChange:function(e){return v(e.target.value)}}),Object(a.jsx)("input",{type:"password",placeholder:"Password",value:_,onChange:function(e){return w(e.target.value)}}),Object(a.jsx)("input",{type:"submit",value:"Sign up"})]})})})})}var C=n(37),U=function(e){var t=e.component,n=Object(C.a)(e,["component"]);return Object(a.jsx)(u.b,Object(v.a)(Object(v.a)({},n),{},{component:function(e){return(localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null)?Object(a.jsx)(t,Object(v.a)({},e)):Object(a.jsx)(u.a,{to:"/login"})}}))};var I=function(){var e=Object(d.c)((function(e){return e.auth})),t=Object(d.b)();return Object(c.useEffect)((function(){e.authenticated||t(function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,t(n?{type:"".concat(h,"_SUCCESS"),payload:{user:n}}:{type:"".concat(h,"_FAILURE"),payload:{error:"Login again please"}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(a.jsx)("div",{className:"App",children:Object(a.jsxs)(o.a,{children:[Object(a.jsx)(U,{exact:!0,path:"/",component:_}),Object(a.jsx)(u.b,{path:"/login",component:w}),Object(a.jsx)(u.b,{path:"/signup",component:N})]})})},k=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,59)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))},A=n(21),R=n(36),L={firstname:"",lastname:"",email:"",authenticating:!1,authenticated:!1,error:null},F={users:[],conversations:[]},T=Object(A.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(console.log(t),t.type){case"".concat(h,"_REQUEST"):e=Object(v.a)(Object(v.a)({},e),{},{authenticating:!0});break;case"".concat(h,"_SUCCESS"):e=Object(v.a)(Object(v.a)(Object(v.a)({},e),t.payload.user),{},{authenticated:!0,authenticating:!1});break;case"".concat(h,"_FAILURE"):e=Object(v.a)(Object(v.a)({},e),{},{authenticated:!1,authenticating:!1,error:t.payload.error});break;case"".concat(O,"_REQUEST"):break;case"".concat(O,"_SUCCESS"):e=Object(v.a)({},L);break;case"".concat(O,"_FAILURE"):e=Object(v.a)(Object(v.a)({},e),{},{error:t.payload.error})}return e},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"".concat(m,"_REQUEST"):break;case"".concat(m,"_SUCCESS"):e=Object(v.a)(Object(v.a)({},e),{},{users:t.payload.users});break;case g:e=Object(v.a)(Object(v.a)({},e),{},{conversations:t.payload.conversations});break;case"".concat(g,"_FAILURE"):e=Object(v.a)(Object(v.a)({},e),{},{conversations:[]})}return e}}),P=new A.d(T,Object(A.a)(R.a));p.a.initializeApp({apiKey:"AIzaSyB3_XFxGj_RMXwUANBvac33m5miJD0OGnc",authDomain:"web-messenger-29894.firebaseapp.com",projectId:"web-messenger-29894",storageBucket:"web-messenger-29894.appspot.com",messagingSenderId:"966043581478",appId:"1:966043581478:web:2107b51d1d11f04d837ae7",measurementId:"G-C13B1W1K0F"}),window.store=P,i.a.render(Object(a.jsx)(d.a,{store:P,children:Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(I,{})})}),document.getElementById("root")),k()}},[[58,1,2]]]);
//# sourceMappingURL=main.6c0851da.chunk.js.map